# 1、首先四级缓存的介绍
	- ## 1、一级缓存Scrap 缓存
	  collapsed:: true
		- [[#red]]==**用来缓存还在屏幕内的ViewHolder**==,Scrap 是 RecyclerView 中最轻量的缓存，它不参与滑动时的回收复用
		- [[#green]]==**mAttachedScrap**==：负责保存将会[[#green]]==**原封不动的ViewHolder**==。
			- 比如屏幕四个ABCD 删除一个B，那么AB存入 这里 CD上移 存入mChangedScrap
		- [[#green]]==**mChangedScrap**==：负责保存位置会发生移动的ViewHolder
			- 注意[[#red]]==**只是位置发生移动**==，内容仍原封不动。
			- 比如（删除item后的上移）或者和动画相关的
	- ## 2、二级缓存CachedViews缓存
	  collapsed:: true
		- 用来缓存移除屏幕外的viewHolder
		- 默认[[#red]]==**最大值为2**==
	- ## 3、三级缓存自定义缓存
	- ## 4、四级缓存RecycledPool 缓存
	  collapsed:: true
		- 1、pool 的数据结构他是个  SparseArray（key 只为int的 map）key 为 ViewType value 为 ArrayList
		- 2、每个ArrayList[[#green]]==**最多存储5个**==。
		- 3、RecyclerView提供了这种缓存形式，支持多个RecyclerView之间复用View，也就是说通过自定义Pool我们甚至可以实现整个应用内的RecyclerView的View的复用
- # 2、取缓存的原理
	- ## 首先
		- Recyclerview的缓存和复用入口有两种情况，
		- 1、onTouchEvent [[#green]]==**move**==事件
		- 2、就是Recyclerview布局[[#green]]==**onLayout**==的时候。最终执行的代码都一样
	- ## 以滑动时入口为例
		- 核心方法执行路径：Action_Move -> [[#red]]==**LinearLayoutManager.next**==方法 => [[#green]]==**recycleView.getViewForPosition**===> 最终调用位置：[[#red]]==**tryGetViewHolderForPositionByDeadline**==
	- 具体获取流程  [[tryGetViewHolderForPositionByDeadline从缓存找ViewHolder]]
		- 1、根据id和 position从mChangedScrap 去拿
		- 2、通过VIewType 和position 和从 mAttachedScrap  和 mCachedViews获取
		- 3、三级缓存-自定义缓存，自己实现获取的方法
		- 4、四级缓存根据 ViewType 从缓存池里面获取
		- 5、如果都没拿到，就创建走createViewHolder
			- 6、判断是否需要绑定：tryBindViewHolderByDeadline
- # 3、缓存的回收原理
	- 入口在[[#blue]]==**onLayoutChildren**==
	- ###  3-1、首先处理CacheView的缓存
		- 如果CachedViews 条数未达到最大值，则直接缓存 ViewHolder。
		- 如果CachedViews 条数已经达到最大值，则将 CachedViews 中最老的一个 ViewHolder 移到 RecycledViewPool 中，然后缓存ViewHolder
		- 总结
			- 1、RecyclerViewPool里的大部分来源于mCachedVIews，小部分直接屏幕加入的
			- 2、CacheView 存的是带有数据的viewHolder。经过bind 的viewHolder
	- ### 3-2、处理RecyclerViewPool缓存的
		- 1、如果 CachedViews 没有缓存成功，则直接将 ViewHolder 缓存到 RecycledViewPool 。
		- 2、当 RecycledViewPool 中ViewType 对应的ViewHolder缓存数量达到最大5个时，则不再缓存。
		- 3、没有超过的话把viewHolder 清空，再保存
		- (这里需要重新bind )
	- ### 3-3、处理一级缓存的
		- 1、通过mAttachedScrap 进行保存位置没有发生改变的
		- 2、通过mChangedScrap  保存位置改变的
-
-
- # 参考
	- # [[Recyclerview复用机制-怎么从四级缓存取]]
	- # [[Recyclerview回收/缓存机制-怎么存到四级缓存]]