- # 一、简介：[问题排查，日志难](https://docs.58corp.com/#/space/1619941563754934272)
  collapsed:: true
	- 开发一套统一规范的日志库：
	- ### 1、各模块日志 tag 不统一
	  collapsed:: true
		- 如埋点内部，埋点策略、埋点写入、上报分成多个一级 tag；RN Native、JS、Error 等同样也是多个一级 tag，无法根据 tag 快速查看单个模块的日志。需要区分出一级 tag 和二级 tag。
		- 解决：配置定义主TAG和二级TAG(按功能模块区分)。log输出时 主TAG-二级TAG
			- @UnityLogConfig(
			      className = "DemoUnityLogger",
			      primaryKey = TagAnnotation(
			          key = "UnityLogSDK",
			          des = "统一标准日志SDK"
			      ),
			      tags = arrayOf(
			          TagAnnotation(
			              key = "testModule",
			              des = "测试"
			          ),
			          TagAnnotation(
			              key = "runModules",
			              des = "执行组件"
			          )
			      )
			  )
			  class DemoUnityLogConfig {
			  
			  }
	- ### 2、关键模块日志缺失 (需要补全)
	  collapsed:: true
		- 如核心业务的执行流程、跨端/跨应用/跨模块等的通信过程、长时间运行组件的行为/状态切换、多个分支逻辑的判断等。
		- 解决：日志补全
	- ### 3、日志缺失很多关键信息
	  collapsed:: true
		- 环境信息：
			- 基础环境：系统、网络、机型
			- 日志环境：进程、线程、Activity、前后台、登陆状态、crash 时需要数据(如内存、gc...) 等
			- 关联代码：根据日志快速定位 class:method()
			- 方法入参数据
			- 排查方法：针对日志关键信息，可定制输出对应的排查方法解决方案
			- header、cookie 信息
		- 解决：
			- Log输出时，携带环境信息
	- ### 4、存在多套日志库
	  collapsed:: true
		- App、SDK、垂直业务库的 log 日志，58Flipper，线上的日志回捞各存在对应的 log 输出工具
		  线上、线下日志开关控制不统一
		- 解决：统一一套日志库，开关控制统一
	- ### 5、日志格式不统一
	  collapsed:: true
		- 日志的格式不统一
		  无法对关键核心的日志进行高亮显示 (如关键节点、空 url 等常规性异常进行提示)
		- 解决：日志SDK,统一拼装信息，和格式
	- ### 6、使用方不知道各模块日志的关键 tag
	  collapsed:: true
		- 由于未聚合日志库，无法在日志模块启动时输出所有已注册的日志业务的关键 tag 和说明
		- 解决：下边的功能一
	- ### 7、无法快速与 flipper 对接
	  collapsed:: true
		- 不规范的日志，flipper 开发各插件，如 RN、Hybrid、埋点、分享、log 等，需要各自定制去做开发，对 SDK 进行回调梳理。而规范日志后，可以通过日志格式，快速开发各种 flipper 应用插件。
	- ### 8、无法对状态变化进行主动输出
	  collapsed:: true
		- 四大组件的切换，包括 Activity(又可以区分成 Native、RN、H5)，Service...
		  Activity 的生命周期
		  路由信息
		  网络变化
		  进程变化
		- 解决：对各个信息，直接监听，统一TAG="UnityLogSmart"输出
		-
	- ### 9、无法与历史行为数据进行对比，发现异常
		- 如埋点、网络、分享的行为对比
		- 解决：
- # 二、设计
  collapsed:: true
	- ![image.png](../assets/image_1678256116856_0.png)
- # 功能一、编译期收集注解信息，获取所有的组件模块，在 UnifyLogSDK 初始化时，输出 help
  collapsed:: true
	- help:
	  collapsed:: true
		- ```
		  UnifyLog 注册的组件信息如下：
		  (你可以使用 adb logcat | grep $primaryKey 过滤出组件的所有日志，
		  使用 adb logcat | grep $primaryKey-$tag 过来出组件子模块的日志，如 xxx,
		  使用 adb logcat | grep UnifyLogSmart 过来出日志库智能提示，包括 xxx 状态变化通知)
		  
		  --------------------------------------------------------------
		  primaryKey: WubaRNSDK
		  
		  描述：RN SDK
		  
		  tag：
		    1. hotUpdate：热更新
		    2. runModules：执行组件
		    ...
		  --------------------------------------------------------------
		  primaryKey: WubaHybridSDK
		  
		  描述：Hybrid SDK
		  
		  tag：
		    1. web init：web 初始化
		    2. web preload：预加载
		    ...
		  --------------------------------------------------------------
		  ```
	- 原理见常见问题中
- # 功能二、API设计
	- 该功能库只为了好排查问题，外层对外API只根据输出环境区分。
	  collapsed:: true
		- ```kotlin
		  package com.wuba.unitylog
		  
		  interface IUnityLog {
		      fun debug(
		          tag: String , messageGenerator: IMessageGenerator? ,
		          owner: LogOwner? = null
		      )
		  
		      fun debug(
		          tag: String , error: Throwable? ,
		          owner: LogOwner? = null
		      )
		  
		      fun debug(
		          tag: String , messageGenerator: IMessageGenerator? , error: Throwable? ,
		          owner: LogOwner? = null
		      )
		  
		      fun release(
		          tag: String , messageGenerator: IMessageGenerator? ,
		          owner: LogOwner? = null
		      )
		  
		      fun release(
		          tag: String , error: Throwable? ,
		          owner: LogOwner? = null
		      )
		  
		      fun release(
		          tag: String , messageGenerator: IMessageGenerator? , error: Throwable? ,
		          owner: LogOwner? = null
		      )
		  
		      fun wlog(
		          tag: String , messageGenerator: IMessageGenerator? ,
		          owner: LogOwner? = null
		      )
		  
		      fun wlog(
		          tag: String , error: Throwable? ,
		          owner: LogOwner? = null
		      )
		  
		      fun wlog(
		          tag: String , messageGenerator: IMessageGenerator? , error: Throwable? ,
		          owner: LogOwner? = null
		      )
		  }
		  ```
	- ## Debug(开发环境)
		- 功能：
	- ## Release(线上环境)
	- ## WLog(日志回捞环境)
-
-
- # [[日志库常见问题]]